<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Go DNS æŸ¥è¯¢æºç è§£æï¼šLookupIP"><meta property="og:description" content="GO DNS lookup ä»£ç ä½äº net/lookup.go ä¸‹ func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error) å‡½æ•°ä¸­ã€‚è¿™ä¸ªå‡½æ•°æœ‰å‡ ä¸ªè®¾è®¡å’Œç‰¹æ€§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼š
èƒ½å¯¹ç›¸åŒ Host çš„æŸ¥è¯¢è¯·æ±‚è¿›è¡Œåˆå¹¶ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼› ä½¿ç”¨ channel + select è¯­å¥ï¼Œå®ç°ä¼˜é›…çš„åŒæ­¥è¯·æ±‚æ“ä½œï¼› ä½¿ç”¨ Cancelã€Deadline Contextï¼Œå®ç°ç»ˆæ­¢è¯·æ±‚ï¼› Context å–æ¶ˆï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–åˆå¹¶çš„è¯·æ±‚å¾—åˆ°ç»“æœï¼› åº•å±‚ä½¿ç”¨ cgo æ¥è°ƒç”¨ C è¯­è¨€ä»£ç æ‰§è¡Œ DNS æŸ¥è¯¢ã€‚ ä»¥ä¸‹æˆ‘ä»¬å°†é€æ­¥ä»‹ç» lookupIPAddr æ˜¯æ ¸å¿ƒä»£ç ï¼š
1 2 3 4 5 // LookupIPAddr looks up host using the local resolver. // It returns a slice of that host's IPv4 and IPv6 addresses. func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error) { return r."><meta property="og:type" content="article"><meta property="og:url" content="https://huanggze.top/posts/go-dns-lookup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-17T17:48:53+08:00"><meta property="article:modified_time" content="2022-09-17T17:48:53+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go DNS æŸ¥è¯¢æºç è§£æï¼šLookupIP"><meta name=twitter:description content="GO DNS lookup ä»£ç ä½äº net/lookup.go ä¸‹ func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error) å‡½æ•°ä¸­ã€‚è¿™ä¸ªå‡½æ•°æœ‰å‡ ä¸ªè®¾è®¡å’Œç‰¹æ€§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼š
èƒ½å¯¹ç›¸åŒ Host çš„æŸ¥è¯¢è¯·æ±‚è¿›è¡Œåˆå¹¶ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼› ä½¿ç”¨ channel + select è¯­å¥ï¼Œå®ç°ä¼˜é›…çš„åŒæ­¥è¯·æ±‚æ“ä½œï¼› ä½¿ç”¨ Cancelã€Deadline Contextï¼Œå®ç°ç»ˆæ­¢è¯·æ±‚ï¼› Context å–æ¶ˆï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–åˆå¹¶çš„è¯·æ±‚å¾—åˆ°ç»“æœï¼› åº•å±‚ä½¿ç”¨ cgo æ¥è°ƒç”¨ C è¯­è¨€ä»£ç æ‰§è¡Œ DNS æŸ¥è¯¢ã€‚ ä»¥ä¸‹æˆ‘ä»¬å°†é€æ­¥ä»‹ç» lookupIPAddr æ˜¯æ ¸å¿ƒä»£ç ï¼š
1 2 3 4 5 // LookupIPAddr looks up host using the local resolver. // It returns a slice of that host's IPv4 and IPv6 addresses. func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error) { return r."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#262d33"><title>Hi Folks - Go DNS æŸ¥è¯¢æºç è§£æï¼šLookupIP</title><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=/minima.1673700236.css><script defer type=text/javascript src=/minima.1673700236.js></script></head><script>try{"theme"in localStorage||(localStorage.theme=window.matchMedia("(prefer-color-scheme: dark)").matches?"dark":"light"),document.querySelector("html").classList.add(localStorage.theme)}catch(e){console.error(e)}</script><body class="sm:mx-5 sm:my-0"><header class="flex justify-between items-center mb-6 sm:my-3"><div class="flex items-center"><div id=theme-switcher class="text-4xl cursor-pointer">ğŸŒ</div></div><nav class="flex items-center
whitespace-nowrap overflow-x-auto overflow-y-hidden"><a class=ml-5 href=/>Home</a>
<a class=ml-5 href=/categories>Categories</a>
<a class=ml-5 href=/series>Series</a>
<a class=ml-5 href=/about>About</a></nav></header><details class="toc toc-lines"><summary></summary><div class=pb-1><nav id=TableOfContents><ul><li><a href=#resolver>Resolver</a></li><li><a href=#lookupipaddr>lookupIPAddr</a></li><li><a href=#dochan>DoChan</a></li><li><a href=#lookupip>lookupIP</a></li></ul></nav></div></details><h1 class="mt-6 mb-6">Go DNS æŸ¥è¯¢æºç è§£æï¼šLookupIP</h1><div class="mb-3 text-xs flex justify-between sm:flex-col"><div>Posted at &mdash; Sep 17, 2022</div></div><main><p></p><article class=md><p>GO DNS lookup ä»£ç ä½äº <a href=https://github.com/golang/go/blob/go1.17.1/src/net/lookup.go#L206>net/lookup.go</a> ä¸‹ <code>func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error)</code> å‡½æ•°ä¸­ã€‚è¿™ä¸ªå‡½æ•°æœ‰å‡ ä¸ªè®¾è®¡å’Œç‰¹æ€§ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼š</p><ol><li>èƒ½å¯¹ç›¸åŒ Host çš„æŸ¥è¯¢è¯·æ±‚è¿›è¡Œåˆå¹¶ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼›</li><li>ä½¿ç”¨ channel + select è¯­å¥ï¼Œå®ç°ä¼˜é›…çš„åŒæ­¥è¯·æ±‚æ“ä½œï¼›</li><li>ä½¿ç”¨ Cancelã€Deadline Contextï¼Œå®ç°ç»ˆæ­¢è¯·æ±‚ï¼›</li><li>Context å–æ¶ˆï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–åˆå¹¶çš„è¯·æ±‚å¾—åˆ°ç»“æœï¼›</li><li>åº•å±‚ä½¿ç”¨ cgo æ¥è°ƒç”¨ C è¯­è¨€ä»£ç æ‰§è¡Œ DNS æŸ¥è¯¢ã€‚</li></ol><p>ä»¥ä¸‹æˆ‘ä»¬å°†é€æ­¥ä»‹ç» lookupIPAddr æ˜¯æ ¸å¿ƒä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// LookupIPAddr looks up host using the local resolver.
</span></span></span><span class=line><span class=cl><span class=c1>// It returns a slice of that host&#39;s IPv4 and IPv6 addresses.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>Resolver</span><span class=p>)</span> <span class=nf>LookupIPAddr</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>host</span> <span class=kt>string</span><span class=p>)</span> <span class=p>([]</span><span class=nx>IPAddr</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>lookupIPAddr</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;ip&#34;</span><span class=p>,</span> <span class=nx>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=resolver>Resolver</h2><p>é¦–å…ˆï¼Œè¯¥å‡½æ•°æ˜¯ Resolver çš„æˆå‘˜æ–¹æ³•ï¼ŒResolver ç»“æ„ä½“æ˜¯ä¸€ä¸ª DNS è§£æå™¨ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Resolver</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>PreferGo</span> <span class=kt>bool</span> <span class=c1>// æ˜¯å¦ä½¿ç”¨ Go å®ç°çš„ DNS è§£æå™¨ï¼Œè¿˜æ˜¯ç”¨ CGO è°ƒç”¨ C è¯­è¨€çš„ä»£ç 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Dial</span> <span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>address</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>Conn</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=c1>// Go å®ç°çš„ DNS è§£æå™¨ä¼šè°ƒç”¨è¯¥å‡½æ•°æ¥ï¼Œæ¥å‘èµ· DNS è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>lookupGroup</span> <span class=nx>singleflight</span><span class=p>.</span><span class=nx>Group</span> <span class=c1>// ç”¨äºåˆå¹¶ç›¸åŒ host çš„ DNS æŸ¥è¯¢
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼Œå› ä¸º lookupGroup å­—æ®µï¼Œæ‰å¾—ä»¥å®ç°å¯¹ç›¸åŒ Host çš„æŸ¥è¯¢è¯·æ±‚è¿›è¡Œåˆå¹¶ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚<code>singleflight.Group</code> å…¶å®æ˜¯ä¸€ä¸ª mapï¼Œkey æ— ç–‘æ˜¯ host å­—ç¬¦ä¸²ï¼Œvalue æ˜¯å‘èµ·çš„è¯·æ±‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleflight</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Group ç”¨äºå»é‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Group</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mu</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>       <span class=c1>// protects m
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>m</span>  <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=o>*</span><span class=nx>call</span> <span class=c1>// lazily initialized
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// call is an in-flight or completed singleflight.Do call
</span></span></span><span class=line><span class=cl><span class=c1>// call ä»£è¡¨ä¸€æ¬¡ DNS æŸ¥è¯¢è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>call</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=nx>dups</span>  <span class=kt>int</span> <span class=c1>// è®°å½•é‡å¤è¯·æ±‚æ¬¡æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>chans</span> <span class=p>[]</span><span class=kd>chan</span><span class=o>&lt;-</span> <span class=nx>Result</span> <span class=c1>// å­˜æ”¾æŸ¥è¯¢ç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Result holds the results of Do, so they can be passed
</span></span></span><span class=line><span class=cl><span class=c1>// on a channel.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Result</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Val</span>    <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>Err</span>    <span class=kt>error</span>
</span></span><span class=line><span class=cl>    <span class=nx>Shared</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=lookupipaddr>lookupIPAddr</h2><p>LookupIPAddr å®é™…è¯·æ±‚çš„æ˜¯ lookupIPAddr å†…éƒ¨æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»£ç éª¨æ¶å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>dnsWaitGroup</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>Resolver</span><span class=p>)</span> <span class=nf>lookupIPAddr</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span> <span class=kt>string</span><span class=p>)</span> <span class=p>([]</span><span class=nx>IPAddr</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// DNS æŸ¥è¯¢å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>resolverFunc</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>lookupIP</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// çœŸæ­£æ‰§è¡Œ DoChan çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥ç”¨ ctxï¼Œè€Œæ˜¯å†åˆ›å»ºä¸€ä¸ª lookupGroupCtx
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// è¿™æ˜¯ä¸ºäº†é¿å…ï¼Œctx è¢«å–æ¶ˆï¼Œå½±å“åˆ°å…¶ä»–å¹¶å‘çš„æŸ¥è¯¢ã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// å¯ä»¥çœ‹åˆ° withUnexpiredValuesPreserved ä¸­å¦èµ·äº†ä¸€ä¸ª context.Background()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>lookupGroupCtx</span><span class=p>,</span> <span class=nx>lookupGroupCancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithCancel</span><span class=p>(</span><span class=nf>withUnexpiredValuesPreserved</span><span class=p>(</span><span class=nx>ctx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>lookupKey</span> <span class=o>:=</span> <span class=nx>network</span> <span class=o>+</span> <span class=s>&#34;\000&#34;</span> <span class=o>+</span> <span class=nx>host</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å‘èµ·è¯·æ±‚åŠ å…¥ WaitGroup ä¸­ç­‰å¾…æ‰§è¡Œå®Œæˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>dnsWaitGroup</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œç»“æœä¼šå†™å…¥ chï¼›å¦‚æœæ˜¯é‡å¤è¯·æ±‚ï¼Œcalled è¿”å› false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// getLookupGroup æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå°±æ˜¯è¿”å› singleflight.Group
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ch</span><span class=p>,</span> <span class=nx>called</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>getLookupGroup</span><span class=p>().</span><span class=nf>DoChan</span><span class=p>(</span><span class=nx>lookupKey</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nx>dnsWaitGroup</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>testHookLookupIP</span><span class=p>(</span><span class=nx>lookupGroupCtx</span><span class=p>,</span> <span class=nx>resolverFunc</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>called</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>dnsWaitGroup</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ç”±äº Context å–æ¶ˆï¼Œè¯·æ±‚ç»“æŸå¹¶æŠ¥é”™
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=nx>r</span><span class=p>.</span><span class=nf>getLookupGroup</span><span class=p>().</span><span class=nf>ForgetUnshared</span><span class=p>(</span><span class=nx>lookupKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>lookupGroupCancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;-</span><span class=nx>ch</span>
</span></span><span class=line><span class=cl>                <span class=nf>lookupGroupCancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>err</span> <span class=o>:=</span> <span class=nf>mapErr</span><span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Err</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>r</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>lookupIPReturn</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Val</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Err</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Shared</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>é¦–å…ˆï¼ŒdnsWaitGroup è¿è¡Œå¹¶è®°å½•å¤šä¸ª DNS æŸ¥è¯¢ã€‚å½“ lookupIPAddr è¢«å¹¶å‘è°ƒç”¨æ—¶ï¼ŒdnsWaitGroup ä¼šå¤šæ¬¡ <code>dnsWaitGroup.Add(1)</code>ã€‚</p><p>å®é™…æ‰§è¡ŒæŸ¥è¯¢çš„ï¼Œæ˜¯é€šè¿‡ DoChan æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸‹é¢å†è¯¦ç»†ä»‹ç»ã€‚åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹çœ‹æœ€å select çš„è¯­å¥ã€‚è¿™ä¸ª select è¯­å¥æœ‰ä¸¤ä¸ª caseã€‚ç¬¬ä¸€ä¸ª case åˆ¤æ–­ ctx æ˜¯å¦å‘ç”Ÿäº†å–æ¶ˆã€‚å¦‚æœå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œå–æ¶ˆ DNS æŸ¥è¯¢ã€‚ä½†æ³¨æ„ï¼Œæˆ‘ä»¬å¼€å¤´è¯´è¿‡ï¼ŒGo è¿™é‡Œæ˜¯åšäº†å¤šä¸ªå¹¶å‘è¯·æ±‚åˆå¹¶ï¼Œé‚£ä¹ˆè¦åœ¨ ForgetUnshared() é‡Œè¿›ä¸€æ­¥åˆ¤æ–­ï¼Œæ˜¯å¦åªæœ‰è‡ªå·±åœ¨æŸ¥è¯¢ã€‚åªæœ‰è‡ªå·±å°±ç›´æ¥å–æ¶ˆï¼Œä¸æ˜¯çš„è¯ï¼Œä»ç­‰å¾…æŸ¥è¯¢å®Œæˆï¼Œå› ä¸ºå…¶ä»–å¹¶å‘çš„è¯·æ±‚ï¼Œè¿˜è¦ç­‰å¾…ç»“æœã€‚</p><p>æœ€åï¼Œç»“æœç”± lookupIPReturn() å‡½æ•°åŒ…è£…åè¿”å›ã€‚</p><h2 id=dochan>DoChan</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹ DoChanã€‚DoChan æ‰§è¡Œä¸€æ¬¡ DNS æŸ¥è¯¢ï¼Œå®é™…æ‰§è¡Œæ—¶è°ƒç”¨å…¥å‚å‡½æ•° fnï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>g</span> <span class=o>*</span><span class=nx>Group</span><span class=p>)</span> <span class=nf>DoChan</span><span class=p>(</span><span class=nx>key</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>fn</span> <span class=kd>func</span><span class=p>()</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>))</span> <span class=p>(</span><span class=o>&lt;-</span><span class=kd>chan</span> <span class=nx>Result</span><span class=p>,</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>Result</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>g</span><span class=p>.</span><span class=nx>m</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>g</span><span class=p>.</span><span class=nx>m</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=o>*</span><span class=nx>call</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>m</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>dups</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>chans</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>chans</span><span class=p>,</span> <span class=nx>ch</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>g</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ch</span><span class=p>,</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>call</span><span class=p>{</span><span class=nx>chans</span><span class=p>:</span> <span class=p>[]</span><span class=kd>chan</span><span class=o>&lt;-</span> <span class=nx>Result</span><span class=p>{</span><span class=nx>ch</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=p>.</span><span class=nx>m</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=p>=</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=nx>g</span><span class=p>.</span><span class=nf>doCall</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>fn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>ch</span><span class=p>,</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// doCall handles the single call for a key.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>g</span> <span class=o>*</span><span class=nx>Group</span><span class=p>)</span> <span class=nf>doCall</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>call</span><span class=p>,</span> <span class=nx>key</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>fn</span> <span class=kd>func</span><span class=p>()</span> <span class=p>(</span><span class=kd>interface</span><span class=p>{},</span> <span class=kt>error</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>val</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>err</span> <span class=p>=</span> <span class=nf>fn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>delete</span><span class=p>(</span><span class=nx>g</span><span class=p>.</span><span class=nx>m</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç»™å¹¶å‘è¯·æ±‚ä¸­çš„æ¯ä¸ª ch éƒ½å‘ä¸€æ¬¡æ•°æ®ï¼Œ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// å› ä¸ºï¼Œæ‰€æœ‰çš„ç»“æœç­‰å¾… channel éƒ½åœ¨è¿™é‡Œï¼Œæ¯ä¸ªéƒ½è¦å‘ä¸€ä»½æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ch</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span><span class=p>.</span><span class=nx>chans</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>Result</span><span class=p>{</span><span class=nx>c</span><span class=p>.</span><span class=nx>val</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>err</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>dups</span> <span class=p>&gt;</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>DoChan çš„æ‰§è¡Œç»“æœä¼šæ”¾åˆ° ch ä¸­ï¼Œch æ˜¯ä¸€ä¸ªé•¿åº¦ä¸ºï¼Œå­˜æ”¾ Result ç»“æœçš„ channelã€‚ä¸ºé¿å…å¹¶å‘è¯·æ±‚ï¼Œg.m[key] è¢«ç”¨äºå»é‡ã€‚å¦‚æœæ˜¯é‡å¤çš„ï¼Œåˆ™æŠŠ call çš„ç»“æœæš‚å­˜ channel c.chans åŠ ä¸€ï¼ˆ<code>c.chans = append(c.chans, ch)</code>ï¼‰ã€‚ä¸æ˜¯é‡å¤çš„ï¼Œåˆ™èµ·ä¸€ä¸ªåç¨‹å»æŸ¥è¯¢ <code>go g.doCall(c, key, fn)</code>ã€‚doCall å®é™…è°ƒç”¨ fn()ï¼Œä¹Ÿå°±æ˜¯å‰é¢ä»£ç ä¸­ <code>r.lookupIP</code> è¿™ä¸ªå‡½æ•°ã€‚</p><h2 id=lookupip>lookupIP</h2><p>å¯ä»¥é¢„æ–™åˆ°ï¼ŒlookupIP ä¼šè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ¥æŸ¥è¯¢ DNSã€‚é‚£ä¹ˆå®ƒæºç å…·ä½“æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸGo æ—¢æœ‰è‡ªå·±å®ç°æ–¹å¼ï¼ˆgoLookupIPï¼‰ï¼Œä¹Ÿæœ‰é€šè¿‡ CGO è°ƒç”¨ C è¯­è¨€ä»£ç å®ç°ï¼ˆcgoLookupIPï¼‰ã€‚ä¸€èˆ¬åªåœ¨ç‰¹æ®Šéœ€æ±‚çš„ debug æ—¶ï¼Œæ‰ä¼šè®© PreferGo ä¸º trueã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>Resolver</span><span class=p>)</span> <span class=nf>lookupIP</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>addrs</span> <span class=p>[]</span><span class=nx>IPAddr</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>r</span><span class=p>.</span><span class=nf>preferGo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nf>goLookupIP</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>order</span> <span class=o>:=</span> <span class=nf>systemConf</span><span class=p>().</span><span class=nf>hostLookupOrder</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=nx>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>order</span> <span class=o>==</span> <span class=nx>hostLookupCgo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>addrs</span><span class=p>,</span> <span class=nx>err</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nf>cgoLookupIP</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>addrs</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// cgo not available (or netgo); fall back to Go&#39;s DNS resolver
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>order</span> <span class=p>=</span> <span class=nx>hostLookupFilesDNS</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>ips</span><span class=p>,</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>goLookupIPCNAMEOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>network</span><span class=p>,</span> <span class=nx>host</span><span class=p>,</span> <span class=nx>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>ips</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>order å®šä¹‰äº†ä»¥ä»€ä¹ˆæ¨¡å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚ç”±äº mac ç”µè„‘ order ä¸€å®šä¼šç­‰äº hostLookupCgoã€‚åé¢ cgoLookupIP() æ¶‰åŠ CGO çŸ¥è¯†ï¼Œä¸å†æ·±å…¥ä»‹ç»ã€‚cgoLookupIP() æœ€ç»ˆè¿”å›æŸ¥è¯¢ç»“æœã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// systemConf returns the machine&#39;s network configuration.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>systemConf</span><span class=p>()</span> <span class=o>*</span><span class=nx>conf</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>confOnce</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=nx>initConfVal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>confVal</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>initConfVal</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// Darwin pops up annoying dialog boxes if programs try to do
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// their own DNS requests. So always use cgo instead, which
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// avoids that.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>runtime</span><span class=p>.</span><span class=nx>GOOS</span> <span class=o>==</span> <span class=s>&#34;darwin&#34;</span> <span class=o>||</span> <span class=nx>runtime</span><span class=p>.</span><span class=nx>GOOS</span> <span class=o>==</span> <span class=s>&#34;ios&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>confVal</span><span class=p>.</span><span class=nx>forceCgoLookupHost</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></article></main><script>const repo="mivinci/hugo-theme-minima",issueTerm="pathname",theme=localStorage.theme?`github-${localStorage.theme}`:"preferred-color-scheme",script=document.createElement("script");script.src="https://utteranc.es/client.js",script.async=!0,script.crossOrigin="anonymous",script.setAttribute("repo",repo),script.setAttribute("issue-term",issueTerm),script.setAttribute("theme",theme),script.setAttribute("label","comment"),document.querySelector("main").appendChild(script)</script><footer class="mt-8 flex sm:flex-col-reverse justify-between items-center"><p class="mt-0 text-sm">Â© huanggze 2021 |
<a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> on
<a href=https://github.com/mivinci/hugo-theme-minima target=_blank rel="noopener noreferrer">Minima</a></p><p class="flex items-center mt-0"><a class="icon mx-2" href=https://github.com/huanggze title=github><svg fill="#63636f" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="icon mx-2" href=/index.xml title=rss><svg fill="#63636f" t="1626591563876" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1984" width="18" height="16"><path d="M128 768a128 128 0 100 256 128 128 0 000-256zM0 368v176c265.104.0 480 214.912 480 480h176c0-362.32-293.696-656-656-656zM0 0v176c468.336.0 848 379.664 848 848h176C1024 458.464 565.536.0.0.0z" p-id="1985"/></svg></a></p></footer></body></html>